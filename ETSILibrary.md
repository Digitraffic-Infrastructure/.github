<div align="center">
    <h1>ETSI Library</h1>
    <p>A library for generating, encoding, and decoding V2X messages compliant with the ETSI standard.</p>
</br>
</br>
</div>

## Features

- **Simple message creation**: Create `CAM`, `DENM`, `SREM`, `SSEM`, `MAPEM`, and `SPATEM` through a simple standardized java interface.
- **Encoding & Decoding**: Encode and decode messages to and from their UPER encoded binary representation.
- **Optional GeoNetworking- and security-headers**: Add Geonetworking header and security header to your messages for message signing compliant with ETSI 103 097.
- **Security**: L0-compliant security implementation and software security module for secure message handling.
- **User feedback**: Built in methods for user feedback for guidance towards creating compliant messages through intuitive message string representations and robust exception handling.

## Release notes
 > ### Release 2.39
 > **Created:** 2025-03-14</br> **Bug fixes:**
 > * Handling of signer type Digest corrected > * Corrected target payload type to be SPATEM on incoming message type SPATEM (Previously SSEM)</br> **Features:**
 None 
 > **Breaking changes:**
 > * Changes namespace of IETSISecurity, ETSISecurity_L0 from digitraffic.security to digitraffic.security.ETSISecurity

 > ### Release 2.39
 > **Created:** 2025-03-14</br> **Bug fixes:**
 > * Handling of signer type Digest corrected > * Corrected target payload type to be SPATEM on incoming message type SPATEM (Previously SSEM)</br> **Features:**
 > 
 > **Breaking changes:**
 > * Changes namespace of IETSISecurity, ETSISecurity_L0 from digitraffic.security to digitraffic.security.ETSISecurity

 > ### Release 2.39
 > **Created:** 2025-03-14</br> **Bug fixes:**
 > * Handling of signer type Digest corrected > * Corrected target payload type to be SPATEM on incoming message type SPATEM (Previously SSEM)</br> **Features:**
 None 
 > **Breaking changes:**
 > * Changes namespace of IETSISecurity, ETSISecurity_L0 from digitraffic.security to digitraffic.security.ETSISecurity

 > ### Release 2.39
 > **Created:** 2025-03-14</br> **Bug fixes:**
 > * Handling of signer type Digest corrected > * Corrected target payload type to be SPATEM on incoming message type SPATEM (Previously SSEM) 
 > **Features:**
 None 
 > **Breaking changes:**
 > * Changes namespace of IETSISecurity, ETSISecurity_L0 from digitraffic.security to digitraffic.security.ETSISecurity

 > ### Release 2.39
 > **Created:** 2025-03-14 
 > **Bug fixes:**
 > * Handling of signer type Digest corrected > * Corrected target payload type to be SPATEM on incoming message type SPATEM (Previously SSEM) 
 > **Features:**
 None 
 > **Breaking changes:**
 > * Changes namespace of IETSISecurity, ETSISecurity_L0 from digitraffic.security to digitraffic.security.ETSISecurity

 > ### Release 2.39
 > **Created:** 2025-03-14</br> **Bug fixes:**
 > * Handling of signer type Digest corrected > * Corrected target payload type to be SPATEM on incoming message type SPATEM (Previously SSEM)
 > **Features:**
 None
 > **Breaking changes:**
 > * Changes namespace of IETSISecurity, ETSISecurity_L0 from digitraffic.security to digitraffic.security.ETSISecurity

 > ### Release 2.39
 > **Created:** 2025-03-14</br> **Bug fixes:**
 > * Handling of signer type Digest corrected > * Corrected target payload type to be SPATEM on incoming message type SPATEM (Previously SSEM)
 > **Features:**
 >
 > **Breaking changes:**
 > * Changes namespace of IETSISecurity, ETSISecurity_L0 from digitraffic.security to digitraffic.security.ETSISecurity

 > ### Release 2.39
 > **Created:** 2025-03-14</br> **Bug fixes:**
 > * Handling of signer type Digest corrected > * Corrected target payload type to be SPATEM on incoming message type SPATEM (Previously SSEM)
 > **Features:**
 >
 > **Breaking changes:**
 > * Changes namespace of IETSISecurity, ETSISecurity_L0 from digitraffic.security to digitraffic.security.ETSISecurity

 > ### Release 2.39
 > **Created:** 2025-03-14</br> **Bug fixes:**
 > * Handling of signer type Digest corrected > * Corrected target payload type to be SPATEM on incoming message type SPATEM (Previously SSEM)
 > **Features:**
 >
 > **Breaking changes:**
 > * Changes namespace of IETSISecurity, ETSISecurity_L0 from digitraffic.security to digitraffic.security.ETSISecurity

 > ### Release 2.39
 > **Created:** 2025-03-14</br> **Bug fixes:**
 > * Handling of signer type Digest corrected > * Corrected target payload type to be SPATEM on incoming message type SPATEM (Previously SSEM)
 > **Features:**
 >
 > **Breaking changes:**
 > * Changes namespace of IETSISecurity, ETSISecurity_L0 from digitraffic.security to digitraffic.security.ETSISecurity

 > ### Release 2.39
 > **Created:** 2025-03-14</br> **Bug fixes:**
 > * Handling of signer type Digest corrected > * Corrected target payload type to be SPATEM on incoming message type SPATEM (Previously SSEM) 
 > **Features:**
 >
 > **Breaking changes:**
 > * Changes namespace of IETSISecurity, ETSISecurity_L0 from digitraffic.security to digitraffic.security.ETSISecurity

 > ### Release 2.39
 > **Created:** 2025-03-14</br> **Bug fixes:**
 > * Handling of signer type Digest corrected > * Corrected target payload type to be SPATEM on incoming message type SPATEM (Previously SSEM) 
 **Features:**
 >
 > **Breaking changes:**
 > * Changes namespace of IETSISecurity, ETSISecurity_L0 from digitraffic.security to digitraffic.security.ETSISecurity

 > ### Release 2.39
 > **Created:** 2025-03-14</br> **Bug fixes:**
 > * Handling of signer type Digest corrected > * Corrected target payload type to be SPATEM on incoming message type SPATEM (Previously SSEM)</br> **Features:**
 >
 > **Breaking changes:**
 > * Changes namespace of IETSISecurity, ETSISecurity_L0 from digitraffic.security to digitraffic.security.ETSISecurity

 > ### Release 2.39
 > **Created:** 2025-03-14</br> **Bug fixes:**
 > * Handling of signer type Digest corrected > * Corrected target payload type to be SPATEM on incoming message type SPATEM (Previously SSEM)
 > **Features:**
 >
 > **Breaking changes:**
 > * Changes namespace of IETSISecurity, ETSISecurity_L0 from digitraffic.security to digitraffic.security.ETSISecurity

 > ### Release 2.39
 > **Created:** 2025-03-14</br> **Bug fixes:**
 > * Handling of signer type Digest corrected > * Corrected target payload type to be SPATEM on incoming message type SPATEM (Previously SSEM)
 > **Features:**
 >
 > **Breaking changes:**
 > * Changes namespace of IETSISecurity, ETSISecurity_L0 from digitraffic.security to digitraffic.security.ETSISecurity

 > ### Release 2.39
 > **Created:** 2025-03-14</br> **Bug fixes:**
 > * Handling of signer type Digest corrected > * Corrected target payload type to be SPATEM on incoming message type SPATEM (Previously SSEM)
 > **Features:**
 > None
 > **Breaking changes:**
 None

 > ### Release 2.39
 > **Created:** 2025-03-14</br> **Bug fixes:**
 > * Handling of signer type Digest corrected > * Corrected target payload type to be SPATEM on incoming message type SPATEM (Previously SSEM)
 > **Features:**
 > None
 > **Breaking changes:**
 None

 > ### Release 2.39
 > **Created:** 2025-03-14</br> **Bug fixes:**
 > * Handling of signer type Digest corrected > * Corrected target payload type to be SPATEM on incoming message type SPATEM (Previously SSEM)
 > **Features:**
 > None
 > **Breaking changes:**
 None

 > ### Release 2.38
 > **Created:** 2025-03-13</br> **Bug fixes:**
 > * Handling of signer type Digest corrected > * Corrected target payload type to be SPATEM on incoming message type SPATEM (Previously SSEM) >
 > **Features:**
 >
 > **Breaking changes:**
 None

 > ### Release 2.38
 > **Created:** 2025-03-13</br> **Bug fixes:**
 > * Handling of signer type Digest corrected > * Corrected target payload type to be SPATEM on incoming message type SPATEM (Previously SSEM) >
 > **Features:**
 >
 > **Breaking changes:**
 >

 > ### Release 2.38
 > **Created:** 2025-03-13</br> **Bug fixes:**
 > * Handling of signer type Digest corrected > * Corrected target payload type to be SPATEM on incoming message type SPATEM (Previously SSEM) >
 > **Features:**
 >
 **Breaking changes**
 >

 > ### Release 2.38
 > **Created:** 2025-03-13</br> **Bug fixes:**
 > * Handling of signer type Digest corrected > * Corrected target payload type to be SPATEM on incoming message type SPATEM (Previously SSEM) >
 > **Features:**
 ></br> **Breaking changes**
 >

 > ### Release 2.38
 > **Created:** 2025-03-13</br> **Bug fixes:**
 > * Handling of signer type Digest corrected > * Corrected target payload type to be SPATEM on incoming message type SPATEM (Previously SSEM) ></br> **Features:**
 ></br> **Breaking changes**
 >

 > ### Release 2.38
 > **Created:** 2025-03-13</br> **Bug fixes:**
 > 	 > * Handling of signer type Digest corrected > * Corrected target payload type to be SPATEM on incoming message type SPATEM (Previously SSEM) ></br> **Features:** FEATURES</br> **Breaking changes** BREAKING_CHANGES

 > ### Release 2.38
 > **Created:** 2025-03-13</br> **Bug fixes:**
 > 	 * Handling of signer type Digest corrected * Corrected target payload type to be SPATEM on incoming message type SPATEM (Previously SSEM)</br> **Features:** FEATURES</br> **Breaking changes** BREAKING_CHANGES

 > ### Release 2.38
 > **Created:** 2025-03-13</br> **Bug fixes:**
 * Handling of signer type Digest corrected * Corrected target payload type to be SPATEM on incoming message type SPATEM (Previously SSEM)</br> **Features:** FEATURES</br> **Breaking changes** BREAKING_CHANGES

 > ### Release 2.38
 > **Created:** 2025-03-13</br> **Bug fixes:**</br> * Handling of signer type Digest corrected * Corrected target payload type to be SPATEM on incoming message type SPATEM (Previously SSEM)</br> **Features:** FEATURES</br> **Breaking changes** BREAKING_CHANGES

 > ### Release 2.38
 > **Created:** 2025-03-13</br> **Bug fixes:** * Handling of signer type Digest corrected * Corrected target payload type to be SPATEM on incoming message type SPATEM (Previously SSEM)</br> **Features:** FEATURES</br> **Breaking changes** BREAKING_CHANGES

 > ### Release 2.38
 > **Created:** 2025-03-13</br> **Bug fixes:** BUG_FIXES</br> **Features:** FEATURES</br> **Breaking changes** BREAKING_CHANGES

## Installation

### Using Maven
Add the following dependency to your `pom.xml`:
```xml
<dependency>
    <groupId>digitraffic.link.etsi</groupId>
    <artifactId>etsilibrary</artifactId>
    <version>2.39</version>
</dependency>
```
### Using Gradle
Add the following to your `build.gradle`:
```xml
implementation 'digitraffic.link.etsi:etsilibrary:2.39'
```

## Getting Started

### Basic Example
Hereâ€™s a quick example to get you started:
```java
/************ Library initialization **************/

// Providing license
String license = "[YOUR_DIGITRAFFIC_SOFTWARE_LICENCE]";
LibInitializer.initialize(license);

// or providing license and logger
ConsoleLogger logger = new ConsoleLogger(Level.FINER);
LibInitializer.initialize(license, logger);

// or providing license, logger and security module
SoftwareSecurityModule ssm = new SoftwareSecurityModule("[YOUR_SECURE_STORE_PASSWORD]", "[SECURE_STORE_PATH]", logger);
ETSISecurity_L0 sec = new ETSISecurity_L0("[SIGNING_CERTIFICATE_ID]", ssm, false, logger);

/**************************************************/
/*********** Creating simple payloads *************/

SREM srm = new SREM();
srm.getHeader().setStationId(12345);
srm.getSrm().setSecond(5678);
srm.getSrm().getRequestor().getId().setStationId(12345);
//...

System.out.println(srm.toString());

/**************************************************/
/************** Encoding / Decoding ***************/

byte[] encoding = srm.Encode();

System.out.println(ArrayOperations.toHex(encoding));

SREM decodedSrem = new SREM(encoding);

System.out.println(decodedSrem.toString());

/**************************************************/
/********* Creating complete ETSI message *********/

IETSIMessage basicMessage = ETSIFactory.createMessage(CompileFlags.Basic, srm);
            
System.out.println(basicMessage.toString());

IETSIMessage extendedBasicmessage = ETSIFactory.createMessage(CompileFlags.ExtendedBasic, srm);
System.out.println(extendedBasicmessage.toString());

/**************************************************/
/************** Encoding / Decoding ***************/

byte[] basicMessageEncoding = basicMessage.encode();

IETSIMessage decodedBasicMessage = ETSIFactory.decodeByteArray(basicMessageEncoding);
System.out.println(decodedBasicMessage.toString());

byte[] extendedBasicMessageEncoding = extendedBasicmessage.encode();

IETSIMessage decodedExtendedBasicMessage = ETSIFactory.decodeByteArray(extendedBasicMessageEncoding);
System.out.println(decodedExtendedBasicMessage.toString()); 

/**************************************************/
/**************** Secure messages *****************/

IETSIMessage secureMessage = ETSIFactory.createMessage(CompileFlags.Signed, srm);
System.out.println(secureMessage.toString());

byte[] secureMessageEncoding = secureMessage.encode();

IETSIMessage decodedSecureMessage = ETSIFactory.decodeByteArray(secureMessageEncoding);
System.out.println(decodedSecureMessage.toString());

/**************************************************/
```

### Creating certificate store
Example of creating a certificate store programatically to be used in runtime, and to reuse in succesive executions:
#### prerequisites
- OER encoded certificate representations
- Binary representation of private key
  
```java
// Decode certificates
Certificate leafCertificate = new Certificate([LEAF_CERTIFICATE_BYTES]);
Certificate intermediateCertificate = new Certificate([INTERMEDIATE_CERTIFICATE_BYTES]);
// ...
Certificate rootCertificate = new Certificate([ROOT_VERTIFICATE_BYTES]);

// Create new security module instance
SoftwareSecurityModule ssm = new SoftwareSecurityModule();

//Add private key and add the returned key id to the associated certificate
String keyId = tssm.addPrivateKey([PRIVATE_KEY_BYTES]);
leafCertificate.setPrivateKeyId(keyId);

//Add certificates - Begin with root and the rest of the chain down to the leaf certificate
ssm.addCertificate(rootCertificate, rootCertificate.getId());
ssm.addCertificate(intermediateCertificate, intermediateCertificate.getId());
// ...
ssm.addCertificate(leafCertificate, leafCertificate.getId());

// Store to file
ssm.save(new File([STORE_PATH]), "[STORE_PASSWORD]");

//.
//.
//.

// Create new instance of security module using the store
SoftwareSecurityModule ssm = new SoftwareSecurityModule("[STORE_PASSWORD]", "[STORE_PATH]", logger/null);
```

